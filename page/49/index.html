<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="Joe Huang"><meta name="copyright" content="Joe Huang"><title>Awaken Desparado</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 4.1.1"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="false"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Joe Huang</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">298</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">25</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">45</span></a></div></div></div><nav class="no-bg" id="nav"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Awaken Desparado</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span><span class="pull-right"></span></div><div id="site-info"><div id="site-title">Awaken Desparado</div><div id="site-sub-title"></div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2019/05/03/LC/2019-05-03-Remove-Element/">LC/2019-05-03-Remove-Element</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-05-03</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/LC/">LC</a></span><div class="content"><p>RemoveElement</p>
<p>​</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/05/03/OOD/2019-05-03-OOD_basics_review%20&amp;%20Design_Elevator/">OOD/2019-05-03-OOD_basics_review &amp; Design_Elevator</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-05-03</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/OOD/">OOD</a></span><div class="content"><h1 id="SOLID"><a href="#SOLID" class="headerlink" title="SOLID"></a>SOLID</h1><h3 id="Single-Responsibility"><a href="#Single-Responsibility" class="headerlink" title="Single Responsibility"></a>Single Responsibility</h3><blockquote>
<p>SOLID当中的S， 代表的是Single Responsibility Principle (SRP), 指的是设计当中的每个类，应该都有自己明确的职责，从而使得每个类，都应该有且只有一个改变它的理由。SRP也是实现高内聚(high cohesion)的一个重要原则。</p>
</blockquote>
<h3 id="Open-Close"><a href="#Open-Close" class="headerlink" title="Open Close"></a>Open Close</h3><ul>
<li><p>open to extension, close to modification</p>
</li>
<li><p>一個對象或實體應該對擴展開放，修改是封閉</p>
</li>
<li><p>如AreaCalculator 不該視不同的形狀在加不同的API，而是該傳入抽象Shape Interface實做 getArea()</p>
</li>
</ul>
<h3 id="Liskov-substitution-amp-Interface-Segregation"><a href="#Liskov-substitution-amp-Interface-Segregation" class="headerlink" title="Liskov substitution &amp; Interface Segregation"></a>Liskov substitution &amp; Interface Segregation</h3><ul>
<li>子類應該要可以替換父類</li>
<li>如機器人繼承人類就不好，不能吃喝拉撒</li>
<li>如 Shape裡要是有計算體積跟面積的abstract method, 就不該直接讓Rectangle繼承，不然不合理，最好是中間再插一層2D Shape後再給Rectangle繼承，就是可以分為平面跟立體的Shape做</li>
</ul>
<h4 id="Interface-Segregation"><a href="#Interface-Segregation" class="headerlink" title="Interface Segregation"></a>Interface Segregation</h4><ul>
<li>機器人用不上人的吃喝拉撒 interface，就不該讓它實踐人的這些功能</li>
</ul>
<blockquote>
<ul>
<li>可以这样理解吗： SingleResponsibility 是为了解决后续维护中class过于臃肿的原则，InterfaceSegragation 是为了解决面向外部调用者让其他开发人员更容易明白不同接口的功能区别而总结的原则。<ul>
<li>Yes</li>
</ul>
</li>
<li>接口分离是什么？<ul>
<li>假设现在我们有一个interface提供给用户，但是里面有<strong>太多用户不需要的功能，显得我们的interface过于臃肿</strong>；那么这时候我们就要把这个大的接口根据功能再次细分，然后提供给<strong><em>不同的用户</em></strong>。这就叫接口分离。</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="Dependency-Inversion"><a href="#Dependency-Inversion" class="headerlink" title="Dependency Inversion"></a>Dependency Inversion</h3><ul>
<li>high level不該依賴於 low level實體這類的具體的實現<ul>
<li>如AreaCalculator裡不該依賴「三角形」，而是該依賴「Shape」這個抽象的東西，而別依賴「具體」的low level實體。</li>
<li>讓大家的設計的dependency</li>
</ul>
</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gehjmjbxptj30vq0ao10p.jpg" alt="image-20200505141044760" style="zoom:67%;" />





<h1 id="5C-Analyzation"><a href="#5C-Analyzation" class="headerlink" title="5C Analyzation"></a>5C Analyzation</h1><ul>
<li>Clarify<ul>
<li>What, how</li>
<li>Elevator <ul>
<li>Scheduler</li>
</ul>
</li>
</ul>
</li>
<li>Core Object<ul>
<li>Input, output, mapping </li>
</ul>
</li>
<li>Cases<ul>
<li>需要支持哪些功能？</li>
</ul>
</li>
</ul>
<h2 id="Clarify"><a href="#Clarify" class="headerlink" title="Clarify"></a>Clarify</h2><p>what, how</p>
<h2 id="Core-Objects"><a href="#Core-Objects" class="headerlink" title="Core Objects"></a>Core Objects</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">	A[Request] --&gt;	B[ElevatorSystem] --&gt; |1toN|C[OneElevator] --&gt; D[ElevatorButton]</span><br></pre></td></tr></table></figure>

<p>​                                    ↓</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">	class Request</span><br><span class="line">  class ElevatorSystem&#123;</span><br><span class="line">  	-List&lt;Elevator&gt; elevators</span><br><span class="line">  &#125;</span><br><span class="line">  class Elevator&#123;</span><br><span class="line">  	-List&lt;ElevatorButton&gt; buttons</span><br><span class="line">  &#125;</span><br><span class="line">  class ElevatorButton</span><br></pre></td></tr></table></figure>

<blockquote>
<h4 id="Visibility"><a href="#Visibility" class="headerlink" title="Visibility"></a><a href="https://mermaid-js.github.io/mermaid/#/classDiagram?id=visibility" target="_blank" rel="noopener">Visibility</a></h4><p>To specify the visibility of a class member (i.e. any attribute or method), these notations may be placed before the member’s name, but it is optional:</p>
<ul>
<li><code>+</code> Public</li>
<li><code>-</code> Private</li>
<li><code>#</code> Protected</li>
<li><code>~</code> Package/Internal</li>
</ul>
</blockquote>
<blockquote>
<h5 id="多选题-在设计电梯系统的Core-Object时，需要考虑哪些Object之间的对应关系？"><a href="#多选题-在设计电梯系统的Core-Object时，需要考虑哪些Object之间的对应关系？" class="headerlink" title="[多选题]在设计电梯系统的Core Object时，需要考虑哪些Object之间的对应关系？"></a>[多选题]在设计电梯系统的Core Object时，需要考虑哪些Object之间的对应关系？</h5><p>A.Request 和 Elevator System 之间的关系34.18% 选择</p>
<p>B.Elevator System 和 Elevator 之间的关系34.72% 选择</p>
<p>C.Elevator 和 Elevator Button 之间的关系31.10% 选择</p>
<p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTM0MTgxMjgxODM5IiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjM3NjIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxOC4xMiA1MTYuMTZtLTQ5MCAwYTQ5MCA0OTAgMCAxIDAgOTgwIDAgNDkwIDQ5MCAwIDEgMC05ODAgMFoiIGZpbGw9IiM1NkI0MzIiIHAtaWQ9IjM3NjMiPjwvcGF0aD48cGF0aCBkPSJNMzkzLjIxMzYxOSA2NjQuMzM1NDk1bTI4LjI4NDI3MS0yOC4yODQyNzFsMjk2Ljk4NDg0OS0yOTYuOTg0ODQ4cTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBsMCAwcTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDJsLTI5Ni45ODQ4NDggMjk2Ljk4NDg0OHEtMjguMjg0MjcxIDI4LjI4NDI3MS01Ni41Njg1NDMgMGwwIDBxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDJaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY0Ij48L3BhdGg+PHBhdGggZD0iTTI4OS40Njk4NCA0NTIuODQ3ODgzbTI4LjI4NDI3MSAyOC4yODQyNzFsMTU1LjU2MzQ5MiAxNTUuNTYzNDkycTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDNsMCAwcS0yOC4yODQyNzEgMjguMjg0MjcxLTU2LjU2ODU0MyAwbC0xNTUuNTYzNDkxLTE1NS41NjM0OTJxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDNsMCAwcTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY1Ij48L3BhdGg+PC9zdmc+" alt="img">答对了，您选择的答案是ABC</p>
<p><strong>正确答案:</strong>ABC</p>
<p><strong>解析:</strong></p>
<p>在考虑电梯问题时，把Request可以看成是输入</p>
<p>可以把Elevator看成Elevator System的输出</p>
<p>一个电梯会有很多的按钮，所以Elevator 和 Elevator Button 之间存在联系v</p>
</blockquote>
<h2 id="Cases"><a href="#Cases" class="headerlink" title="Cases"></a>Cases</h2><blockquote>
<ul>
<li>所以为啥不建一个elevator gate 和一个weight sensor 然后和这个elevator 来11对应呢<ul>
<li>如果过分的追求单一功能原则反而会让各种class看上去shi’fen’yong’zhong</li>
</ul>
</li>
</ul>
</blockquote>
<blockquote>
<p>在UML类图当中，每个方法和属性都会用前缀修饰符来表示其访问级别。若没有前缀修饰符则代表此方法或属性属于Package内都可访问，在不同Package内不能直接访问。若有修饰符：’+’表示Public，代表此方法或属性公开，能在任何地方都能直接访问；’-‘表示Private，代表此方法或属性私有 ，只能通过类内部访问；’#’表示Protected，代表此方法或属性为保护，在同一个Package内可以访问，在另一个Package内需要通过子类继承才能进行访问。</p>
</blockquote>
<h2 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">	class ExternalRequest</span><br><span class="line">  class ElevatorSystem&#123;</span><br><span class="line">  	-List&lt;Elevator&gt; elevators</span><br><span class="line">  	+void handleRequest(ExternalRequest r)</span><br><span class="line">  &#125;</span><br><span class="line">  class Elevator&#123;</span><br><span class="line">  	-List&lt;ElevatorButton&gt; buttons</span><br><span class="line">  &#125;</span><br><span class="line">  class ElevatorButton</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="center">Use cases</th>
</tr>
</thead>
<tbody><tr>
<td align="center">Handle request</td>
</tr>
<tr>
<td align="center">Take external request</td>
</tr>
<tr>
<td align="center">Take internal request</td>
</tr>
<tr>
<td align="center">Open gate</td>
</tr>
<tr>
<td align="center">Close gate</td>
</tr>
<tr>
<td align="center">Check weight</td>
</tr>
<tr>
<td align="center">Press button</td>
</tr>
</tbody></table>
<blockquote>
<ul>
<li>所以为什么handle 这个function是public? 什么叫use case是外部的？use case 莫非还有内部的？<ul>
<li>外部的就是指别的class调用当前的class，内部的就是指自己class内部进行调用。</li>
</ul>
</li>
</ul>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">	class InvalidExternalRequestException</span><br></pre></td></tr></table></figure>

<blockquote>
<p>但是我们也知道，一部电梯，不一样时段人流量是不同的；比如上下班高峰期会有很多人使用，而晚上下班后可能使用频率就没有那么高。对于这种情况，我们又可以如何去改进我们的设计呢？这里给大家介绍这个课程里我们要学的第一个Design Pattern ——— Strategy Design Pattern。</p>
</blockquote>
<h2 id="Strategy-Design-Pattern"><a href="#Strategy-Design-Pattern" class="headerlink" title="Strategy Design Pattern"></a>Strategy Design Pattern</h2><ul>
<li>封装了多種算法、策略</li>
<li>使得算法/策略之間能互相替換，也方便擴展</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">classDiagram</span><br><span class="line">	Context *-- Strategy</span><br><span class="line">	Strategy &lt;|-- ConcreteStrategyA</span><br><span class="line">  Strategy &lt;|-- ConcreteStrategyB</span><br><span class="line">	Strategy : &lt;&lt;interface&gt;&gt;</span><br><span class="line">	Strategy : +execute()</span><br><span class="line">  ConcreteStrategyA : +execute()</span><br><span class="line">  ConcreteStrategyB : +execute()</span><br></pre></td></tr></table></figure>

<p>%    class ConcreteStrategyA{+execute()}<br>%    class ConcreteStrategyB{+execute()}</p>
<h1 id="QA"><a href="#QA" class="headerlink" title="QA"></a>QA</h1><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gehh3at4owj30kc0x0wip.jpg" alt="image-20200505124305507" style="zoom:50%;" />



<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gehh5ez7r4j30kg0qatbo.jpg" alt="image-20200505124515467" style="zoom:50%;" />

<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gehkq0lsiaj30hc0v60wm.jpg" alt="image-20200505144843469" style="zoom:50%;" />

<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gehksimowgj30h80ouq51.jpg" alt="image-20200505145108218" style="zoom:50%;" />

<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gehktcr3whj30iy0t6tda.jpg" alt="image-20200505145156636" style="zoom:50%;" />

<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gehkvd81ovj30ho0r4diz.jpg" alt="image-20200505145359955" style="zoom:50%;" /></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/05/03/Python/2019-05-03-cls/">Python/2019-05-03-cls</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-05-03</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Python/">Python</a></span><div class="content"><p>For <code>classmethod</code>s, the first parameter is the class through which the class method is invoked with instead of the usual <code>self</code> for <code>instancemethod</code>s (which all methods in a class implicitly are unless specified otherwise).</p>
<p>Here’s an example – and for the sake of exercise, I added an exception that checks the identity of the <code>cls</code> parameter.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Base</span><span class="params">(object)</span>:</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">acquire</span><span class="params">(cls, param)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> cls <span class="keyword">is</span> Base:</span><br><span class="line">            <span class="keyword">raise</span> Exception(<span class="string">"Must be called via subclass :("</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"this is the result of `acquire`ing a %r with %r"</span> % (cls, param)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Something</span><span class="params">(Base)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnotherThing</span><span class="params">(Base)</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> Something.acquire(<span class="string">"example"</span>)</span><br><span class="line"><span class="keyword">print</span> AnotherThing.acquire(<span class="string">"another example"</span>)</span><br><span class="line"><span class="keyword">print</span> Base.acquire(<span class="string">"this will crash"</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">this <span class="keyword">is</span> the result of `acquire`ing a &lt;<span class="class"><span class="keyword">class</span> '<span class="title">__main__</span>.<span class="title">Something</span>'&gt; <span class="title">with</span> '<span class="title">example</span>'</span></span><br><span class="line"><span class="class"><span class="title">this</span> <span class="title">is</span> <span class="title">the</span> <span class="title">result</span> <span class="title">of</span> `<span class="title">acquire</span>`<span class="title">ing</span> <span class="title">a</span> &lt;<span class="title">class</span> '<span class="title">__main__</span>.<span class="title">AnotherThing</span>'&gt; <span class="title">with</span> '<span class="title">another</span> <span class="title">example</span>'</span></span><br><span class="line"><span class="class"><span class="title">Traceback</span> <span class="params">(most recent call last)</span>:</span></span><br><span class="line">  File <span class="string">"classmethod.py"</span>, line <span class="number">16</span>, <span class="keyword">in</span> &lt;module&gt;</span><br><span class="line">    <span class="keyword">print</span> Base.acquire(<span class="string">"this will crash"</span>)</span><br><span class="line">  File <span class="string">"classmethod.py"</span>, line <span class="number">5</span>, <span class="keyword">in</span> acquire</span><br><span class="line">    <span class="keyword">raise</span> Exception(<span class="string">"Must be called via subclass :("</span>)</span><br><span class="line">Exception: Must be called via subclass :(</span><br></pre></td></tr></table></figure></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/04/23/System-Design/9p/2019-04-23-Crawler%20&amp;%20Typeahead%20Design/">System-Design/9p/2019-04-23-Crawler &amp; Typeahead Design</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-04-23</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/SystemDesign/">SystemDesign</a></span><div class="content"><h1 id="General"><a href="#General" class="headerlink" title="General"></a>General</h1><ul>
<li><p>打擂台算法 - 就topk</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">secondMax</span><span class="params">(self, nums)</span>:</span></span><br><span class="line">	first = <span class="literal">None</span></span><br><span class="line">  second = <span class="literal">None</span></span><br><span class="line">  <span class="keyword">for</span> num <span class="keyword">in</span> nums:</span><br><span class="line">    <span class="keyword">if</span> first <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> first &lt; num:</span><br><span class="line">      second = first</span><br><span class="line">      first = num</span><br><span class="line">    <span class="keyword">elif</span> second <span class="keyword">is</span> <span class="literal">None</span> <span class="keyword">or</span> second &lt; num:</span><br><span class="line">      second = num</span><br><span class="line">    <span class="keyword">return</span> second</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>DB Engines, kv strorage persistence  – , as Hash on Disk</p>
<ul>
<li>Redis 常駐內存</li>
<li>DynamoDB</li>
<li>MemcacheD – 斷電就沒了</li>
<li>RocksDB</li>
<li>Cassandra - Sharding(row) &amp; Range Query(col)</li>
</ul>
</li>
<li><p>MapReduce</p>
<ul>
<li><p>Word Count</p>
<ul>
<li><p>不是所有都可以進內存</p>
</li>
<li><p>單進程單機性能問題</p>
</li>
<li><p>單詞算哈希然後模機器數，同個單詞一定在同一台機器上。</p>
</li>
<li><pre><code class="python"><span class="class"><span class="keyword">class</span> <span class="title">WordCount</span>:</span>
  <span class="function"><span class="keyword">def</span> <span class="title">mapper</span><span class="params">(self, _, line)</span>:</span>
    <span class="keyword">for</span> word <span class="keyword">in</span> line.split():
      <span class="keyword">yield</span> word, <span class="number">1</span>

  <span class="function"><span class="keyword">def</span> <span class="title">reducer</span><span class="params">(self, key, values)</span>:</span>
    <span class="keyword">yield</span> key, sum(values)
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- intersection of 2 arrays, too easy</span><br><span class="line"></span><br><span class="line">  &#96;&#96;&#96;python</span><br><span class="line">  from collections import Counter </span><br><span class="line">  </span><br><span class="line">  class Solution:</span><br><span class="line">      &quot;&quot;&quot;</span><br><span class="line">      @param nums1: an integer array</span><br><span class="line">      @param nums2: an integer array</span><br><span class="line">      @return: an integer array</span><br><span class="line">      &quot;&quot;&quot;</span><br><span class="line">  </span><br><span class="line">      def intersection(self, nums1, nums2):</span><br><span class="line">          s1 &#x3D; Counter(nums1)</span><br><span class="line">          s2 &#x3D; Counter(nums2)</span><br><span class="line">  </span><br><span class="line">          ans &#x3D; []</span><br><span class="line">          for k in s1.keys():</span><br><span class="line">              # n &#x3D; min(s1[k], s2.get(k, 0))</span><br><span class="line">              # for _ in range(n):</span><br><span class="line">              if k in s2.keys():        </span><br><span class="line">                  ans.append(k)</span><br><span class="line">          return ans</span><br></pre></td></tr></table></figure>


</code></pre>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p>WordBreak</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solution</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wordBreak</span><span class="params">(self, s: str, wordDict: List[str])</span> -&gt; bool:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> s:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">          </span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> wordDict:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">          </span><br><span class="line">        ws = set(wordDict) <span class="comment"># wordSet</span></span><br><span class="line">        dp = [<span class="literal">False</span>] * len(s)   <span class="comment"># means states</span></span><br><span class="line">        <span class="comment"># abcde</span></span><br><span class="line">        dp[<span class="number">0</span>] = s[<span class="number">0</span>] <span class="keyword">in</span> ws</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, len(dp)):</span><br><span class="line">            <span class="comment"># print(i)</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">if</span> s[:i+<span class="number">1</span>] <span class="keyword">in</span> ws:</span><br><span class="line">                dp[i] = <span class="literal">True</span></span><br><span class="line">                <span class="keyword">continue</span> </span><br><span class="line">            <span class="comment"># print(dp)            </span></span><br><span class="line">            start = i</span><br><span class="line">            </span><br><span class="line">            <span class="string">"""</span></span><br><span class="line"><span class="string">            dp[1] =     s[1:1+1] in ws and dp[0]    # s[1] in ws and dp[0]  </span></span><br><span class="line"><span class="string">                        or </span></span><br><span class="line"><span class="string">                        s[0:1+1] in ws                     </span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">            dp[2] =     s[2:2+1] in ws and dp[1]    ## s[2]</span></span><br><span class="line"><span class="string">                        or </span></span><br><span class="line"><span class="string">                        s[1:2+1] in ws and dp[0] </span></span><br><span class="line"><span class="string">                        or </span></span><br><span class="line"><span class="string">                        s[0:2+1] in ws</span></span><br><span class="line"><span class="string">            """</span></span><br><span class="line">            <span class="keyword">while</span> start &gt;= <span class="number">0</span>:</span><br><span class="line">                <span class="comment"># if s[start:i+1] in ws and dp[start-1]:</span></span><br><span class="line">                <span class="keyword">if</span> dp[start<span class="number">-1</span>] <span class="keyword">and</span> s[start:i+<span class="number">1</span>] <span class="keyword">in</span> ws:</span><br><span class="line">                    dp[i] = <span class="literal">True</span></span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">                start -= <span class="number">1</span></span><br><span class="line">                </span><br><span class="line">        <span class="keyword">return</span> dp[<span class="number">-1</span>]</span><br></pre></td></tr></table></figure>



</li>
</ul>
<h1 id="Web-Crawler"><a href="#Web-Crawler" class="headerlink" title="Web Crawler"></a>Web Crawler</h1><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8kxuh73nj30qu0b2jtu.jpg" alt="image-20200427200540662" style="zoom:50%;" />

<blockquote>
<ul>
<li>除了中文分词，英文搜索是不是也要分词？<ul>
<li>英文搜索不用分词。你不会跟人说：hellonicetomeetyou 的。</li>
</ul>
</li>
</ul>
</blockquote>
<blockquote>
<ul>
<li>为了对网页进行分析，解析出链接信息，标题信息等，我们是需要保存整张网页的，而不只是纯文本内容。</li>
<li>搜索引擎的相关技术每一个都是一个深坑，慎入！在系统设计的面试中考得最多的当然还是 Web Crawler。另外关于倒排索引（Inverted Index）和 分词（Word Segmentation）的技术最好也是要知道的。</li>
</ul>
</blockquote>
<h2 id="Inverted-Index"><a href="#Inverted-Index" class="headerlink" title="Inverted Index"></a>Inverted Index</h2><ul>
<li>從 word 指向 doc id list 的索引 (index)</li>
<li>反過來就是 forward index (doc id -&gt; list of words)</li>
</ul>
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8l2imdk0j30z80b8gwi.jpg" alt="image-20200427201034185" style="zoom:67%;" />

<blockquote>
<ul>
<li>当用户搜索 Hello World 的时候，搜索引擎会去倒排索引中检索 Hello 和 World 共同出现的文档有哪些，并且求出交集。</li>
</ul>
</blockquote>
<h2 id="Chinese-Word-Segmentation"><a href="#Chinese-Word-Segmentation" class="headerlink" title="Chinese Word Segmentation"></a>Chinese Word Segmentation</h2><p>中文分詞字字間沒有區分 e.g.化妝和服妝</p>
<ul>
<li>Viterbi Algorithm</li>
<li>Word-break</li>
<li>早期 G廠在中國沒做所以有一陣子時被B超過</li>
</ul>
<h1 id="Design-Crawler"><a href="#Design-Crawler" class="headerlink" title="Design Crawler"></a>Design Crawler</h1><h2 id="Scenario"><a href="#Scenario" class="headerlink" title="Scenario"></a>Scenario</h2><ul>
<li><p>全抓下並建 inverted index</p>
</li>
<li><p>網頁間存在指向的anchor關係</p>
</li>
<li><p>節點 &amp; 有向邊</p>
</li>
<li><p>Google 立身之本- ”page rank” 看各網頁被引用的高低</p>
<ul>
<li>被更多其他網頁指向的網頁，具有更高的價值</li>
</ul>
</li>
</ul>
<h3 id="開始爬的網頁"><a href="#開始爬的網頁" class="headerlink" title="開始爬的網頁"></a>開始爬的網頁</h3><ul>
<li>as seed urls</li>
<li>新聞網站作起點很好、Alexa(Amazon下的做的看流量排名)也可以</li>
</ul>
<h3 id="Producer-Consumer"><a href="#Producer-Consumer" class="headerlink" title="Producer/Consumer"></a>Producer/Consumer</h3><ul>
<li>BFS爬，在有向圖上爬</li>
</ul>
<blockquote>
<h5 id="单选题-Web-Crawler-一般可以使用哪种算法？"><a href="#单选题-Web-Crawler-一般可以使用哪种算法？" class="headerlink" title="[单选题]Web Crawler 一般可以使用哪种算法？"></a>[单选题]Web Crawler 一般可以使用哪种算法？</h5><p>A.深度优先搜索 DFS20.53% 选择</p>
<p>B.宽度优先搜索 BFS79.47% 选择</p>
<p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTM0MTgxMjgxODM5IiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjM3NjIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxOC4xMiA1MTYuMTZtLTQ5MCAwYTQ5MCA0OTAgMCAxIDAgOTgwIDAgNDkwIDQ5MCAwIDEgMC05ODAgMFoiIGZpbGw9IiM1NkI0MzIiIHAtaWQ9IjM3NjMiPjwvcGF0aD48cGF0aCBkPSJNMzkzLjIxMzYxOSA2NjQuMzM1NDk1bTI4LjI4NDI3MS0yOC4yODQyNzFsMjk2Ljk4NDg0OS0yOTYuOTg0ODQ4cTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBsMCAwcTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDJsLTI5Ni45ODQ4NDggMjk2Ljk4NDg0OHEtMjguMjg0MjcxIDI4LjI4NDI3MS01Ni41Njg1NDMgMGwwIDBxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDJaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY0Ij48L3BhdGg+PHBhdGggZD0iTTI4OS40Njk4NCA0NTIuODQ3ODgzbTI4LjI4NDI3MSAyOC4yODQyNzFsMTU1LjU2MzQ5MiAxNTUuNTYzNDkycTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDNsMCAwcS0yOC4yODQyNzEgMjguMjg0MjcxLTU2LjU2ODU0MyAwbC0xNTUuNTYzNDkxLTE1NS41NjM0OTJxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDNsMCAwcTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY1Ij48L3BhdGg+PC9zdmc+" alt="img">答对了，您选择的答案是B</p>
<p><strong>正确答案:</strong>B</p>
<p><strong>解析:</strong></p>
<p>互联网上的网页所构成的图巨大无比，如果使用 DFS 的话，深度太深也不易加入并行化的处理。使用 BFS 比较直观和方便。</p>
</blockquote>
<ul>
<li>DFS會讓我在抓時一個網站都還沒抓多少就跳走了。</li>
<li>解析快；抓慢</li>
</ul>
<h3 id="多進程抓"><a href="#多進程抓" class="headerlink" title="多進程抓"></a>多進程抓</h3><blockquote>
<h5 id="单选题-单进程-single-process-模型的爬虫的瓶颈是什么？"><a href="#单选题-单进程-single-process-模型的爬虫的瓶颈是什么？" class="headerlink" title="[单选题]单进程(single process)模型的爬虫的瓶颈是什么？"></a>[单选题]单进程(single process)模型的爬虫的瓶颈是什么？</h5><p>A.解析网页的速度太慢18.17% 选择</p>
<p>B.网络请求慢，单进程大部分时候处于闲置(idle)状态81.83% 选择</p>
<p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTM0MTgxMjgxODM5IiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjM3NjIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxOC4xMiA1MTYuMTZtLTQ5MCAwYTQ5MCA0OTAgMCAxIDAgOTgwIDAgNDkwIDQ5MCAwIDEgMC05ODAgMFoiIGZpbGw9IiM1NkI0MzIiIHAtaWQ9IjM3NjMiPjwvcGF0aD48cGF0aCBkPSJNMzkzLjIxMzYxOSA2NjQuMzM1NDk1bTI4LjI4NDI3MS0yOC4yODQyNzFsMjk2Ljk4NDg0OS0yOTYuOTg0ODQ4cTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBsMCAwcTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDJsLTI5Ni45ODQ4NDggMjk2Ljk4NDg0OHEtMjguMjg0MjcxIDI4LjI4NDI3MS01Ni41Njg1NDMgMGwwIDBxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDJaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY0Ij48L3BhdGg+PHBhdGggZD0iTTI4OS40Njk4NCA0NTIuODQ3ODgzbTI4LjI4NDI3MSAyOC4yODQyNzFsMTU1LjU2MzQ5MiAxNTUuNTYzNDkycTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDNsMCAwcS0yOC4yODQyNzEgMjguMjg0MjcxLTU2LjU2ODU0MyAwbC0xNTUuNTYzNDkxLTE1NS41NjM0OTJxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDNsMCAwcTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY1Ij48L3BhdGg+PC9zdmc+" alt="img">答对了，您选择的答案是B</p>
<p><strong>正确答案:</strong>B</p>
</blockquote>
<blockquote>
<h5 id="单选题-开-2000-个进程是否可以做到每秒钟下载-1000-个网页？"><a href="#单选题-开-2000-个进程是否可以做到每秒钟下载-1000-个网页？" class="headerlink" title="[单选题]开 2000 个进程是否可以做到每秒钟下载 1000 个网页？"></a>[单选题]开 2000 个进程是否可以做到每秒钟下载 1000 个网页？</h5><p>A.可以10.21% 选择</p>
<p>B.不可以89.79% 选择</p>
<p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTM0MTgxMjgxODM5IiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjM3NjIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxOC4xMiA1MTYuMTZtLTQ5MCAwYTQ5MCA0OTAgMCAxIDAgOTgwIDAgNDkwIDQ5MCAwIDEgMC05ODAgMFoiIGZpbGw9IiM1NkI0MzIiIHAtaWQ9IjM3NjMiPjwvcGF0aD48cGF0aCBkPSJNMzkzLjIxMzYxOSA2NjQuMzM1NDk1bTI4LjI4NDI3MS0yOC4yODQyNzFsMjk2Ljk4NDg0OS0yOTYuOTg0ODQ4cTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBsMCAwcTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDJsLTI5Ni45ODQ4NDggMjk2Ljk4NDg0OHEtMjguMjg0MjcxIDI4LjI4NDI3MS01Ni41Njg1NDMgMGwwIDBxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDJaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY0Ij48L3BhdGg+PHBhdGggZD0iTTI4OS40Njk4NCA0NTIuODQ3ODgzbTI4LjI4NDI3MSAyOC4yODQyNzFsMTU1LjU2MzQ5MiAxNTUuNTYzNDkycTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDNsMCAwcS0yOC4yODQyNzEgMjguMjg0MjcxLTU2LjU2ODU0MyAwbC0xNTUuNTYzNDkxLTE1NS41NjM0OTJxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDNsMCAwcTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY1Ij48L3BhdGg+PC9zdmc+" alt="img">答对了，您选择的答案是B</p>
<p><strong>正确答案:</strong>B</p>
<p><strong>解析:</strong></p>
<p>下载效率还受限于 CPU 个数和带宽。2000 个进程会导致大量的进程上下文切换（Context Switch），从而导致代码运行效率下降。</p>
</blockquote>
<p>所以10個核的話啟100個process</p>
<blockquote>
<ul>
<li>nonblocking IO呢？<ul>
<li>non-blocking IO可以在一定程度上解决这个问题，不过单机的并发数始终还是有瓶颈的，当并发的IO数目达到一定数量时还是需要向distributed的方案转变。</li>
</ul>
</li>
<li>请问多process和threading的区别是？<ul>
<li>多process不共享同一片内存，多 thread 共享同一片内存。</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="Storage"><a href="#Storage" class="headerlink" title="Storage"></a>Storage</h2><h3 id="網頁存儲"><a href="#網頁存儲" class="headerlink" title="網頁存儲"></a>網頁存儲</h3><blockquote>
<h5 id="单选题-爬虫抓取下来的网页存在哪儿？"><a href="#单选题-爬虫抓取下来的网页存在哪儿？" class="headerlink" title="[单选题]爬虫抓取下来的网页存在哪儿？"></a>[单选题]爬虫抓取下来的网页存在哪儿？</h5><p>A.爬虫这台机器上8.22% 选择</p>
<p>B.分布式文件系统中（Distributed File System）91.78% 选择</p>
<p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTM0MTgxMjgxODM5IiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjM3NjIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxOC4xMiA1MTYuMTZtLTQ5MCAwYTQ5MCA0OTAgMCAxIDAgOTgwIDAgNDkwIDQ5MCAwIDEgMC05ODAgMFoiIGZpbGw9IiM1NkI0MzIiIHAtaWQ9IjM3NjMiPjwvcGF0aD48cGF0aCBkPSJNMzkzLjIxMzYxOSA2NjQuMzM1NDk1bTI4LjI4NDI3MS0yOC4yODQyNzFsMjk2Ljk4NDg0OS0yOTYuOTg0ODQ4cTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBsMCAwcTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDJsLTI5Ni45ODQ4NDggMjk2Ljk4NDg0OHEtMjguMjg0MjcxIDI4LjI4NDI3MS01Ni41Njg1NDMgMGwwIDBxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDJaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY0Ij48L3BhdGg+PHBhdGggZD0iTTI4OS40Njk4NCA0NTIuODQ3ODgzbTI4LjI4NDI3MSAyOC4yODQyNzFsMTU1LjU2MzQ5MiAxNTUuNTYzNDkycTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDNsMCAwcS0yOC4yODQyNzEgMjguMjg0MjcxLTU2LjU2ODU0MyAwbC0xNTUuNTYzNDkxLTE1NS41NjM0OTJxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDNsMCAwcTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY1Ij48L3BhdGg+PC9zdmc+" alt="img">答对了，您选择的答案是B</p>
<p><strong>正确答案:</strong>B</p>
</blockquote>
<p>這個文件系統還需要給indexer作inverted index，所以不放給爬蟲，</p>
<p>這樣一人作兩角會破壞爬蟲自己的是stateless的思想。</p>
<p>爬蟲要不怕掛，就重啟，跟數據庫不一樣；愈多stateless的系統愈穩定。</p>
<blockquote>
<h5 id="多选题-下列哪些东西是-Stateless-的？"><a href="#多选题-下列哪些东西是-Stateless-的？" class="headerlink" title="[多选题]下列哪些东西是 Stateless 的？"></a>[多选题]下列哪些东西是 Stateless 的？</h5><p>A.Web Server34.37% 选择</p>
<p>B.NoSQL Database9.55% 选择</p>
<p>C.SQL Database5.26% 选择</p>
<p>D.Memcached18.27% 选择</p>
<p>E.Async task worker (message queue consumer)32.55% 选择</p>
<p><strong>正确答案:</strong>AE</p>
<p><strong>解析:</strong></p>
<p>任何存储数据的服务器都是 stateful 的。只执行代码不存储数据的一般是 stateless 的如 Web Server, Async task worker</p>
</blockquote>
<h3 id="BFS中的Queue以及HashSet怎麼存的？"><a href="#BFS中的Queue以及HashSet怎麼存的？" class="headerlink" title="BFS中的Queue以及HashSet怎麼存的？"></a>BFS中的Queue以及HashSet怎麼存的？</h3><h4 id="Queue"><a href="#Queue" class="headerlink" title="Queue"></a>Queue</h4><ul>
<li><p>linkedlist in java</p>
</li>
<li><p>hash for visited</p>
</li>
</ul>
<blockquote>
<h5 id="单选题-BFS算法中使用到的-Queue-存在什么地方？"><a href="#单选题-BFS算法中使用到的-Queue-存在什么地方？" class="headerlink" title="[单选题]BFS算法中使用到的 Queue 存在什么地方？"></a>[单选题]BFS算法中使用到的 Queue 存在什么地方？</h5><p>A.在内存里直接开一个 Queue5.85% 选择</p>
<p>B.使用消息队列（Message Queue）74.03% 选择</p>
<p>C.使用 Memcached20.12% 选择</p>
<p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTM0MTgxMjgxODM5IiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjM3NjIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxOC4xMiA1MTYuMTZtLTQ5MCAwYTQ5MCA0OTAgMCAxIDAgOTgwIDAgNDkwIDQ5MCAwIDEgMC05ODAgMFoiIGZpbGw9IiM1NkI0MzIiIHAtaWQ9IjM3NjMiPjwvcGF0aD48cGF0aCBkPSJNMzkzLjIxMzYxOSA2NjQuMzM1NDk1bTI4LjI4NDI3MS0yOC4yODQyNzFsMjk2Ljk4NDg0OS0yOTYuOTg0ODQ4cTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBsMCAwcTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDJsLTI5Ni45ODQ4NDggMjk2Ljk4NDg0OHEtMjguMjg0MjcxIDI4LjI4NDI3MS01Ni41Njg1NDMgMGwwIDBxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDJaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY0Ij48L3BhdGg+PHBhdGggZD0iTTI4OS40Njk4NCA0NTIuODQ3ODgzbTI4LjI4NDI3MSAyOC4yODQyNzFsMTU1LjU2MzQ5MiAxNTUuNTYzNDkycTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDNsMCAwcS0yOC4yODQyNzEgMjguMjg0MjcxLTU2LjU2ODU0MyAwbC0xNTUuNTYzNDkxLTE1NS41NjM0OTJxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDNsMCAwcTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY1Ij48L3BhdGg+PC9zdmc+" alt="img">答对了，您选择的答案是B</p>
<p><strong>正确答案:</strong>B</p>
</blockquote>
<p>放內存就要擔心斷電的問題。</p>
<h4 id=""><a href="#" class="headerlink" title=""></a></h4><h4 id="HashSet"><a href="#HashSet" class="headerlink" title="HashSet"></a>HashSet</h4><blockquote>
<h5 id="单选题-BFS-中的-HashSet-在系统设计中适合使用什么来存储？"><a href="#单选题-BFS-中的-HashSet-在系统设计中适合使用什么来存储？" class="headerlink" title="[单选题]BFS 中的 HashSet 在系统设计中适合使用什么来存储？"></a>[单选题]BFS 中的 HashSet 在系统设计中适合使用什么来存储？</h5><p>A.内存中开一个哈希表3.14% 选择</p>
<p>B.Memcached21.68% 选择</p>
<p>C.SQL Database4.26% 选择</p>
<p>D.NoSQL Database (Key-value Storage)70.92% 选择</p>
<p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTM0MTgxMjgxODM5IiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjM3NjIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxOC4xMiA1MTYuMTZtLTQ5MCAwYTQ5MCA0OTAgMCAxIDAgOTgwIDAgNDkwIDQ5MCAwIDEgMC05ODAgMFoiIGZpbGw9IiM1NkI0MzIiIHAtaWQ9IjM3NjMiPjwvcGF0aD48cGF0aCBkPSJNMzkzLjIxMzYxOSA2NjQuMzM1NDk1bTI4LjI4NDI3MS0yOC4yODQyNzFsMjk2Ljk4NDg0OS0yOTYuOTg0ODQ4cTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBsMCAwcTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDJsLTI5Ni45ODQ4NDggMjk2Ljk4NDg0OHEtMjguMjg0MjcxIDI4LjI4NDI3MS01Ni41Njg1NDMgMGwwIDBxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDJaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY0Ij48L3BhdGg+PHBhdGggZD0iTTI4OS40Njk4NCA0NTIuODQ3ODgzbTI4LjI4NDI3MSAyOC4yODQyNzFsMTU1LjU2MzQ5MiAxNTUuNTYzNDkycTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDNsMCAwcS0yOC4yODQyNzEgMjguMjg0MjcxLTU2LjU2ODU0MyAwbC0xNTUuNTYzNDkxLTE1NS41NjM0OTJxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDNsMCAwcTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY1Ij48L3BhdGg+PC9zdmc+" alt="img">答对了，您选择的答案是D</p>
<p><strong>正确答案:</strong>D</p>
</blockquote>
<blockquote>
<ul>
<li>message queue是不是stateful的？<ul>
<li>是的</li>
</ul>
</li>
<li>为啥这里不用sql数据库存hashset，如果是多线程并发，要先查set中是否已经存在，然后不存在的话，写入，这是一个事务操作<ul>
<li>从这业务分析，我们可以知道是对每一个domain（域名）中的所有url进行耙取的，而url与其domain的关系1：n的关系，所以，我们在选择NoSQL的数据中，其存储结构是key-value的简单关系结构(key是domain-name，value是List[url])，而且NoSQL系统，其所对应的是Map的结构，而不是Set的结构。如果是多线程。我们要有一个类似信号量的控制访问数据库的锁（如Java.util.concurrent.ReentryLock的使用），即可，不需要事务，事务花销更大，而且大多数NoSQL不支持事务。</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="可行解"><a href="#可行解" class="headerlink" title="可行解"></a>可行解</h2><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge9sne1pgkj30wy0h2wng.jpg" alt="image-20200428211834537" style="zoom:67%;" />

<ul>
<li>注意第７行不是用recursive的，而是讓它去排隊，避免stack overflow</li>
</ul>
<h3 id="Robot-協解"><a href="#Robot-協解" class="headerlink" title="Robot 協解"></a>Robot 協解</h3><p>爬蟲協議。</p>
<blockquote>
<ul>
<li>请问robot协议算是CORS的一种吗<ul>
<li>robot协议是针对爬虫的，告知爬虫对本网站数据的爬取规则。<br>CORS(Cross-Origin Resource Sharing)跨域资源共享是访问跨域资源时，浏览器与服务器应该如何沟通。是为了解决浏览器的<a href="https://en.wikipedia.org/wiki/Same-origin_policy" target="_blank" rel="noopener">同源禁止访问策略</a>。<br>CORS背后的基本思想就是使用自定义的HTTP头部让浏览器与服务器进行沟通，从而决定请求或响应是应该成功还是失败。</li>
</ul>
</li>
</ul>
</blockquote>
<blockquote>
<p>这是知乎的 robots 协议：<a href="https://www.zhihu.com/robots.txt" target="_blank" rel="noopener">https://www.zhihu.com/robots.txt</a><br>更多的关于 robots 协议的规则感兴趣的话可以看看 <a href="https://baike.baidu.com/item/robots/5243374?fr=aladdin" target="_blank" rel="noopener">https://baike.baidu.com/item/robots/5243374?fr=aladdin</a></p>
</blockquote>
<h3 id="限制爬蟲的頻率"><a href="#限制爬蟲的頻率" class="headerlink" title="限制爬蟲的頻率"></a>限制爬蟲的頻率</h3><p>Queue 裡可能對同一個站同時抓太多次。</p>
<p><strong><em>让 Crawler 只做 Consumer，不负责产生新的抓取任务 新增一个 Scheduler (Producer) 负责调度和生产抓取任务 在 Database 中记录每个网站下一次可以友好抓取的时间</em></strong></p>
<blockquote>
<ul>
<li>实际应用中是不是爬虫都有这个scheduler，并不是consumer和producer都爬虫自己做<ul>
<li>是的，一般实用的爬虫框架都会有单独的scheduler，如果对实际的爬虫框架感兴趣的话可以看一下这两个开源的python爬虫框架：pyspider, scrapy</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="更可靠的解"><a href="#更可靠的解" class="headerlink" title="更可靠的解"></a>更可靠的解</h2><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge9v4lect4j310e0gytgt.jpg" alt="image-20200428221447375" style="zoom:67%;" />



<h3 id="表單內容和偽代碼"><a href="#表單內容和偽代碼" class="headerlink" title="表單內容和偽代碼"></a>表單內容和偽代碼</h3><blockquote>
<ul>
<li>课程里说这个UrlInf value里的status代表有没有抓过，有什么用吗？感觉结合后面反复抓取的情况，可能存的是抓取是不是成功的信息，这样可以计算下次抓取的时间（backoff)。不知这样理解对不对？<ul>
<li>一般数据库里我们 status 是最常用的一个 field，用来表示一个事情的进展。 URL 在抓取的过程中，有很多的中间状态的 status，比如抓取成功，抓取失败，正在抓取，还没有抓取过。没有被抓取过的意义是，你可以知道现在有多少网页正在抓取，多少发现了还没抓取，多少已经抓下来了，多少可能是坏链接。这对于监控爬虫的正常工作情况有重大意义。</li>
</ul>
</li>
<li>为什么候选的UrlList要单独放张表，不可以作为DomainInfo的value 的一个Field吗？<ul>
<li>你可以尝试使用一下 MySQL 之类的数据库，你会发现并不能找到一个 List 类型的 field。原因是 List 类型作为普通 MysQL 数据库的的 Field 的话，插入和删除都是 O(N) 的。因此为了更好的支持这种 key to list 的增删查改，要么在 SQL 数据库里用一个张单独的表单，以二元组的形式存储，如 <code>&lt;domain1, url1&gt;</code> <code>&lt;domain1, url2&gt;</code>，要么放在 redis 这种 value 支持 list 的数据库里。总之无论如何，都无法直接和 DomainInfo 放在一起，且数据的含义上，UrlList 也不属于一个 Domain 的 info。info 一般指一些 metadata 之类的信息。</li>
</ul>
</li>
</ul>
</blockquote>
<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge9v4yins0j30uo0kgnbr.jpg" alt="image-20200428224429124" style="zoom:67%;" />



<h3 id="分地區的爬蟲"><a href="#分地區的爬蟲" class="headerlink" title="分地區的爬蟲"></a>分地區的爬蟲</h3><h3 id="處理更新抓取與失效"><a href="#處理更新抓取與失效" class="headerlink" title="處理更新抓取與失效"></a>處理更新抓取與失效</h3><p>BFS裡會有HashSet看抓過沒。但會有更新，怎辦？</p>
<p>可 <strong>Exponential Backoff</strong>去試，搭配邊界。</p>
<blockquote>
<ul>
<li>怎么处理不存在的老的链接呢？<ul>
<li>总是抓取失败的话，就在 UrlInfo 里标记抓取失败，且下次要抓取的时间通过 Exponential Backoff 会慢慢变得很长，比如30天抓一次这种。</li>
</ul>
</li>
</ul>
</blockquote>
<ul>
<li>可md5 16字節看是否一樣，放在url表單裡。</li>
</ul>
<blockquote>
<ul>
<li>如果一个网页变化了，有URL链接的变化怎么处理？是不是把原来存的DomainInfo和UrlInfo都更新（删掉老的数据）？<ul>
<li>比如 <a href="http://www.jiuzhang.com" target="_blank" rel="noopener">www.jiuzhang.com</a> 对应的网页变化了，只需要更新这个 URL 下的网页内容。DomainInfo 和 URLInfo 做一些相应的更新，比如 webpage md5之类的。这个跟这个网页里的 Url 链接是否发生变化没有什么关系。网页里如果发现了新的 URL 就再加到数据库和待抓取列表里即可。</li>
</ul>
</li>
</ul>
</blockquote>
<blockquote>
<p>指数补偿(Exponential Backoff)指的是，在执行事件时，通过反馈，逐渐降低某个过程的速率，从而最终找到一个合适的速率（来处理事件）。</p>
<p>指数补偿通常用于网络和传输协议，比如在进行网络连接时，如果第一次请求失败，那么可以等待 <em>t1</em> 秒之后重试，如果再次请求还是失败，那么等待 <em>t2</em> 秒之后重试。重试可以一直继续下去，直到等待次数或等待时间超过特定值为止。</p>
<p>等待的时间 <em>ti</em> 是可以自由指定的，常用 1, 2, 4, 8 这样的指数序列，因此叫指数补偿。</p>
<p>类似的用到了指数补偿思想的场景还有动态数组（C++ 里的vector，Java 里的 ArrayList，Python 里的 list），动态数组之所以支持你不断的往里加入新元素，就是因为当一个数组满了以后，会再创建一个新的两倍元原来大小的数组来替换掉旧数组。</p>
</blockquote>
<blockquote>
<p>这个文章的作者用 20 台 AWS 的机器在 40 小时内抓取了 2.5亿篇网页，只花了 580$。</p>
<p><a href="http://www.michaelnielsen.org/ddi/how-to-crawl-a-quarter-billion-webpages-in-40-hours/" target="_blank" rel="noopener">http://www.michaelnielsen.org/ddi/how-to-crawl-a-quarter-billion-webpages-in-40-hours/</a></p>
<p>这篇文章中很多的内容是值得参考的比如如何拆分爬取任务的部分，作者的目的是单纯的抓取网页，和我们今天所设计的爬虫相比自然是我们课上讲的架构会更加适合一个真正的爬虫系统。</p>
</blockquote>
<h1 id="Design-TypeAhead-v-s-Google-Suggestion"><a href="#Design-TypeAhead-v-s-Google-Suggestion" class="headerlink" title="Design TypeAhead v.s. Google Suggestion"></a>Design TypeAhead v.s. Google Suggestion</h1><p>兩種不同類型的</p>
<ol>
<li>Typeahead.js </li>
<li>Google Suggestion</li>
</ol>
<ul>
<li>Trie - Re<strong>trie</strong>val</li>
</ul>
<h3 id="Front-End"><a href="#Front-End" class="headerlink" title="Front End"></a>Front End</h3><h3 id="Back-End"><a href="#Back-End" class="headerlink" title="Back End"></a>Back End</h3><ul>
<li>QPS issue</li>
</ul>
<h2 id="Scenario-1"><a href="#Scenario-1" class="headerlink" title="Scenario"></a>Scenario</h2><ul>
<li><p>返回被其他人蒐得多的 Top10 queries</p>
</li>
<li><p>個性化算法的架構</p>
</li>
<li><p>推算QPS ==&gt; 要練心算速推</p>
</li>
</ul>
<blockquote>
<h5 id="单选题-Google-Suggestion-API-主要是读还是写？"><a href="#单选题-Google-Suggestion-API-主要是读还是写？" class="headerlink" title="[单选题]Google Suggestion API 主要是读还是写？"></a>[单选题]Google Suggestion API 主要是读还是写？</h5><p>A.读96.80% 选择</p>
<p>B.写3.20% 选择</p>
<p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTM0MTgxMjgxODM5IiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjM3NjIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxOC4xMiA1MTYuMTZtLTQ5MCAwYTQ5MCA0OTAgMCAxIDAgOTgwIDAgNDkwIDQ5MCAwIDEgMC05ODAgMFoiIGZpbGw9IiM1NkI0MzIiIHAtaWQ9IjM3NjMiPjwvcGF0aD48cGF0aCBkPSJNMzkzLjIxMzYxOSA2NjQuMzM1NDk1bTI4LjI4NDI3MS0yOC4yODQyNzFsMjk2Ljk4NDg0OS0yOTYuOTg0ODQ4cTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBsMCAwcTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDJsLTI5Ni45ODQ4NDggMjk2Ljk4NDg0OHEtMjguMjg0MjcxIDI4LjI4NDI3MS01Ni41Njg1NDMgMGwwIDBxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDJaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY0Ij48L3BhdGg+PHBhdGggZD0iTTI4OS40Njk4NCA0NTIuODQ3ODgzbTI4LjI4NDI3MSAyOC4yODQyNzFsMTU1LjU2MzQ5MiAxNTUuNTYzNDkycTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDNsMCAwcS0yOC4yODQyNzEgMjguMjg0MjcxLTU2LjU2ODU0MyAwbC0xNTUuNTYzNDkxLTE1NS41NjM0OTJxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDNsMCAwcTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY1Ij48L3BhdGg+PC9zdmc+" alt="img">答对了，您选择的答案是A</p>
</blockquote>
<ul>
<li>當讀多寫少時，就是用Cache進行優化</li>
</ul>
<h2 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h2><p>提供Top10Query 查詢</p>
<ul>
<li>QueryService</li>
<li>CollectionService (敲了Enter後)</li>
</ul>
<blockquote>
<h5 id="多选题-为什么我们不让-QueryService-直接请求-CollectionService-获得结果？"><a href="#多选题-为什么我们不让-QueryService-直接请求-CollectionService-获得结果？" class="headerlink" title="[多选题]为什么我们不让 QueryService 直接请求 CollectionService 获得结果？"></a>[多选题]为什么我们不让 QueryService 直接请求 CollectionService 获得结果？</h5><p>A.因为用户很难感知数据是否是最实时的，有一点延迟没有关系36.79% 选择</p>
<p>B.因为 QueryService 请求 CollectionService 实时计算的话，会比较慢43.16% 选择</p>
<p>C.QueryService 请求 CollectionService 的服务器间通信比较慢20.05% 选择</p>
<p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTM0MTgxMjgxODM5IiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjM3NjIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxOC4xMiA1MTYuMTZtLTQ5MCAwYTQ5MCA0OTAgMCAxIDAgOTgwIDAgNDkwIDQ5MCAwIDEgMC05ODAgMFoiIGZpbGw9IiM1NkI0MzIiIHAtaWQ9IjM3NjMiPjwvcGF0aD48cGF0aCBkPSJNMzkzLjIxMzYxOSA2NjQuMzM1NDk1bTI4LjI4NDI3MS0yOC4yODQyNzFsMjk2Ljk4NDg0OS0yOTYuOTg0ODQ4cTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBsMCAwcTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDJsLTI5Ni45ODQ4NDggMjk2Ljk4NDg0OHEtMjguMjg0MjcxIDI4LjI4NDI3MS01Ni41Njg1NDMgMGwwIDBxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDJaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY0Ij48L3BhdGg+PHBhdGggZD0iTTI4OS40Njk4NCA0NTIuODQ3ODgzbTI4LjI4NDI3MSAyOC4yODQyNzFsMTU1LjU2MzQ5MiAxNTUuNTYzNDkycTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDNsMCAwcS0yOC4yODQyNzEgMjguMjg0MjcxLTU2LjU2ODU0MyAwbC0xNTUuNTYzNDkxLTE1NS41NjM0OTJxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDNsMCAwcTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY1Ij48L3BhdGg+PC9zdmc+" alt="img">答对了，您选择的答案是AB</p>
<p><strong>正确答案:</strong>AB</p>
<p><strong>解析:</strong></p>
<p>服务器间通信是很快的。慢的是计算。</p>
</blockquote>
<blockquote>
<ul>
<li>这里CollectionService提供给QueryService信息是用的push模式吗？<ul>
<li>Yes</li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="Storage-1"><a href="#Storage-1" class="headerlink" title="Storage"></a>Storage</h2><h3 id="for-Query-Service"><a href="#for-Query-Service" class="headerlink" title="for Query Service"></a>for Query Service</h3><blockquote>
<h5 id="单选题-是否有支持-Trie-的数据库？"><a href="#单选题-是否有支持-Trie-的数据库？" class="headerlink" title="[单选题]是否有支持 Trie 的数据库？"></a>[单选题]是否有支持 Trie 的数据库？</h5><p>A.没有63.90% 选择</p>
<p>B.有36.10% 选择</p>
<p><img src="data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBzdGFuZGFsb25lPSJubyI/PjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+PHN2ZyB0PSIxNTM0MTgxMjgxODM5IiBjbGFzcz0iaWNvbiIgc3R5bGU9IiIgdmlld0JveD0iMCAwIDEwMjQgMTAyNCIgdmVyc2lvbj0iMS4xIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHAtaWQ9IjM3NjIiIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iMzIiIGhlaWdodD0iMzIiPjxkZWZzPjxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI+PC9zdHlsZT48L2RlZnM+PHBhdGggZD0iTTUxOC4xMiA1MTYuMTZtLTQ5MCAwYTQ5MCA0OTAgMCAxIDAgOTgwIDAgNDkwIDQ5MCAwIDEgMC05ODAgMFoiIGZpbGw9IiM1NkI0MzIiIHAtaWQ9IjM3NjMiPjwvcGF0aD48cGF0aCBkPSJNMzkzLjIxMzYxOSA2NjQuMzM1NDk1bTI4LjI4NDI3MS0yOC4yODQyNzFsMjk2Ljk4NDg0OS0yOTYuOTg0ODQ4cTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBsMCAwcTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDJsLTI5Ni45ODQ4NDggMjk2Ljk4NDg0OHEtMjguMjg0MjcxIDI4LjI4NDI3MS01Ni41Njg1NDMgMGwwIDBxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDJaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY0Ij48L3BhdGg+PHBhdGggZD0iTTI4OS40Njk4NCA0NTIuODQ3ODgzbTI4LjI4NDI3MSAyOC4yODQyNzFsMTU1LjU2MzQ5MiAxNTUuNTYzNDkycTI4LjI4NDI3MSAyOC4yODQyNzEgMCA1Ni41Njg1NDNsMCAwcS0yOC4yODQyNzEgMjguMjg0MjcxLTU2LjU2ODU0MyAwbC0xNTUuNTYzNDkxLTE1NS41NjM0OTJxLTI4LjI4NDI3MS0yOC4yODQyNzEgMC01Ni41Njg1NDNsMCAwcTI4LjI4NDI3MS0yOC4yODQyNzEgNTYuNTY4NTQyIDBaIiBmaWxsPSIjRkZGRkZGIiBwLWlkPSIzNzY1Ij48L3BhdGg+PC9zdmc+" alt="img">答对了，您选择的答案是A</p>
<p><strong>正确答案:</strong>A</p>
</blockquote>
<ul>
<li><p>沒有現成的數據庫，也不大可能自己去寫一套。</p>
<p>替代品就是kv storage，如RocksDB, Redis</p>
<p>kv在空間大一些，但就是系數上的大而已</p>
</li>
</ul>
<p>當Collection Service拿到 apple, </p>
<p>就要新增 a, ap, app … 等的 key，讓他們都append 一次apple，然後打擂台映射到top10的list </p>
<blockquote>
<ul>
<li>Trie的工程上应用意思是什么呢？实际工作中用吗？<ul>
<li>Trie在工程上用得很多，Trie的优势是O(字符串长度)的查找时间和良好的空间性能，相同的前缀只会存一份，因此适合在需要对大量字符串进行存储和查询（尤其是前缀查询）的场景。实际工作中有很多使用Trie及其变形的例子，像这里讲的search suggestion，还有IDE的auto complete, 浏览器的url历史补全，编辑器的spell checkers都可能会用到trie.</li>
</ul>
</li>
<li>”如果某个prefix已经存在了被搜索次数更多的其他10个 queries，就无需再加入了“。两个问题，1）怎么知道是被搜索次数更多的？加入的条件不是一样的吗，比如这里的1b 2) 更新一下是不是更好，因为是更新的结果。<ul>
<li>query 的搜索次数是会被 collection service 记录下来的。比较的时候是带着次数一起比较的。prefix -&gt; top 10 的记录格式是 <code>[{&quot;ap&quot;: {&quot;query&quot;: &quot;app&quot;, &quot;count&quot;: 100}...}]</code></li>
<li>更新 Top 10。</li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="for-Collection-Service"><a href="#for-Collection-Service" class="headerlink" title="for Collection Service"></a>for Collection Service</h3><p>蒐集每個Query 被蒐的次數</p>
<h3 id="-1"><a href="#-1" class="headerlink" title=""></a></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Node</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, is_end=False)</span>:</span></span><br><span class="line">        <span class="comment"># self.val = val</span></span><br><span class="line">        <span class="comment"># self.next = None</span></span><br><span class="line">        self.children = &#123;&#125;</span><br><span class="line">        self.is_end = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Trie</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># do intialization if necessary</span></span><br><span class="line">        <span class="comment"># self.children = &#123;&#125;</span></span><br><span class="line">        self.head = Node(<span class="string">'$'</span>)</span><br><span class="line">        </span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    @param: word: a word</span></span><br><span class="line"><span class="string">    @return: nothing</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, word)</span>:</span></span><br><span class="line">        <span class="comment"># write your code here</span></span><br><span class="line">        node = self.head</span><br><span class="line">        <span class="keyword">for</span> ch <span class="keyword">in</span> word:</span><br><span class="line">            <span class="comment"># print(ch)</span></span><br><span class="line">            <span class="keyword">if</span> ch <span class="keyword">not</span> <span class="keyword">in</span> node.children:</span><br><span class="line">                node.children[ch] = Node()</span><br><span class="line">            node = node.children[ch]</span><br><span class="line">        node.is_end = <span class="literal">True</span></span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    @param: word: A string</span></span><br><span class="line"><span class="string">    @return: if the word is in the trie.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">search</span><span class="params">(self, word)</span>:</span></span><br><span class="line">        <span class="comment"># write your code here</span></span><br><span class="line">        node = self.head</span><br><span class="line">        <span class="keyword">for</span> ch <span class="keyword">in</span> word:</span><br><span class="line">            <span class="comment"># if ch not in self.children:</span></span><br><span class="line">            <span class="keyword">if</span> ch <span class="keyword">not</span> <span class="keyword">in</span> node.children:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            node = node.children[ch]</span><br><span class="line">        <span class="keyword">return</span> node.is_end</span><br><span class="line">        </span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    @param: prefix: A string</span></span><br><span class="line"><span class="string">    @return: if there is any word in the trie that starts with the given prefix.</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">startsWith</span><span class="params">(self, prefix)</span>:</span></span><br><span class="line">        <span class="comment"># write your code here</span></span><br><span class="line">        node = self.head</span><br><span class="line">        <span class="comment"># print(self.children)</span></span><br><span class="line">        <span class="keyword">for</span> ch <span class="keyword">in</span> prefix:</span><br><span class="line">            <span class="keyword">if</span> ch <span class="keyword">not</span> <span class="keyword">in</span> node.children:</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">            node = node.children[ch]</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br></pre></td></tr></table></figure>



<h2 id="Scale"><a href="#Scale" class="headerlink" title="Scale"></a>Scale</h2><h3 id="優化-prefix-gt-Top10的構建-with-Probability"><a href="#優化-prefix-gt-Top10的構建-with-Probability" class="headerlink" title="優化 (prefix =&gt; Top10的構建) with Probability　"></a>優化 (prefix =&gt; Top10的構建) with Probability　</h3><p>不是每條過來的query都有機會成為 top10</p>
<p>萬分之一去命中再把計數加一</p>
<blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">QueryService</span><span class="params">()</span>:</span></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">should_log</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">return</span> random.randint(<span class="number">0</span>, <span class="number">9999</span>) == <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">log_query</span><span class="params">(cls, query)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> cls.should_log():</span><br><span class="line">            database.query_count_plus_one(query)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</blockquote>
<p>prefix =&gt; Top10的構建</p>
<h3 id="打擂台太慢，可以改MapReduce"><a href="#打擂台太慢，可以改MapReduce" class="headerlink" title="打擂台太慢，可以改MapReduce"></a>打擂台太慢，可以改MapReduce</h3><h3 id="用戶打字太快怎辦？"><a href="#用戶打字太快怎辦？" class="headerlink" title="用戶打字太快怎辦？"></a>用戶打字太快怎辦？</h3><p>跳過去！前端等待延時後再發請求。QPS一下可降3~5倍</p>
<h3 id="後端-Backend-Cache-優化"><a href="#後端-Backend-Cache-優化" class="headerlink" title="後端 Backend Cache 優化"></a>後端 Backend Cache 優化</h3><p>100M+ QPS的優化：</p>
<ul>
<li>Backend Cache, 每次更新prefix to top10 去主動更新，PUSH 的方法。</li>
<li>不要懶惰加載</li>
</ul>
<h3 id="前端-Frontend-Cache-優化"><a href="#前端-Frontend-Cache-優化" class="headerlink" title="前端 Frontend Cache 優化"></a>前端 Frontend Cache 優化</h3><ul>
<li>用戶可能常敲一敲再回刪</li>
<li>前端本地直接拿肯定更快</li>
<li>可再加設有效期 (小時、天為單位)</li>
</ul>
<h3 id="預加載"><a href="#預加載" class="headerlink" title="預加載"></a>預加載</h3><p>兩層次的預測加載，如ap的時候，就把app的top10也拉出來了 (因為對於ap而言，app比第二名的高)，就也是一種偷跑。</p>
<p>系統內的通信比用戶的前端跟後端的通信</p>
<blockquote>
<p>refetch 之前的 http response 可能是这样的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;prefix&quot;: &quot;ap&quot;,</span><br><span class="line">  &quot;top10&quot;: [</span><br><span class="line">    &quot;app store&quot;,</span><br><span class="line">    &quot;apple&quot;,</span><br><span class="line">    ...</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>有了 prefetch 以后，http response 可能就是这样的：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[&#123;</span><br><span class="line">  <span class="attr">"prefix"</span>: <span class="string">"ap"</span>,</span><br><span class="line">  <span class="attr">"top10"</span>: [</span><br><span class="line">    <span class="string">"app store"</span>,</span><br><span class="line">    <span class="string">"apple"</span>,</span><br><span class="line">    <span class="string">"amazon"</span>,</span><br><span class="line">    ...</span><br><span class="line">  ],</span><br><span class="line">&#125;, &#123;</span><br><span class="line">  <span class="attr">"prefix"</span>: <span class="string">"app"</span>,</span><br><span class="line">  <span class="attr">"top10"</span>: [</span><br><span class="line">    <span class="string">"app store"</span>,</span><br><span class="line">    <span class="string">"apple"</span>,</span><br><span class="line">    <span class="string">"apple id"</span>,</span><br><span class="line">    ...</span><br><span class="line">  ],</span><br><span class="line">&#125;, ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="實時熱門的-Top10"><a href="#實時熱門的-Top10" class="headerlink" title="實時熱門的 Top10"></a>實時熱門的 Top10</h2><p>Prefix=&gt;top10要是每天一次的更新，趕不上突發事件。</p>
<p>怎麼把熱門的也加進去？這過程是比較慢的，因為量大</p>
<p>＝＞處理最近兩小時的Query Logs ，數據量小甚至不用map reduce, 直接for就ok</p>
<p>也不打機率打折扣</p>
<p>跟過去一年或更久的作權重分配合併。</p>
<h1 id="QA"><a href="#QA" class="headerlink" title="QA"></a>QA</h1><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8kucucubj30ke0to40t.jpg" alt="image-20200427200250304" style="zoom:50%;" />

<img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1ge8kyowkhij30kg0o40uz.jpg" alt="image-20200427200706721" style="zoom:50%;" /></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2019/04/22/Algo.%20Ult./note/">Algo. Ult./note</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2019-04-22</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Languages/">Languages</a></span><div class="content"><h4 id="Hard-to-solve"><a href="#Hard-to-solve" class="headerlink" title="Hard, to solve:"></a>Hard, to solve:</h4><pre><code>- 301.remove-invalidparantheses TLE for enumeration w/ backtracking, 
- 140.word-break-ii a)MLE w/ case &quot;a&quot;*n &amp; b)Trie method (Trie not faster for single query, but for multi query in 472.)
- SegmentTree
- BinaryIndexedTree
- Letter Combinatino of A Phone Number</code></pre><table>
<thead>
<tr>
<th></th>
<th>Python3</th>
<th>Cpp</th>
<th>JS</th>
<th>Java</th>
</tr>
</thead>
<tbody><tr>
<td><strong>dict</strong></td>
<td></td>
<td>include <unordered_map>, //Similar to defaultdict() in python3</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>d = {}</td>
<td>unordered_map&lt;Node*&gt; d;</td>
<td>d = {}; new Map();</td>
<td>Map&lt;Node, Node&gt; visited = new HashMap();</td>
</tr>
<tr>
<td></td>
<td>d[k] = v;</td>
<td>d[k] = v;</td>
<td>d[k]=v; map.<strong>set</strong>(0,1)</td>
<td>visited.<strong>put</strong>(k, v)</td>
</tr>
<tr>
<td></td>
<td>d[k]; d.get(k,0)</td>
<td>d[k];</td>
<td>d[k]; map.get(k)</td>
<td>visited.get(cur_O)</td>
</tr>
<tr>
<td></td>
<td>k not in d</td>
<td>(d.find(k)==d.end())</td>
<td>!(nbr_O.val in visited)</td>
<td>!visited.containsKey(nbr_O)</td>
</tr>
<tr>
<td></td>
<td>k in d</td>
<td>(d.find(k)!=d.end())</td>
<td>nbr_O.val in visited; (map.<strong>has</strong>(sum-k))</td>
<td>visited.<strong>containsKey</strong>(nbr_O)</td>
</tr>
<tr>
<td></td>
<td>del d[k]</td>
<td>d.<strong>erase</strong>(key)</td>
<td>this.d.<strong>delete</strong>(key);</td>
<td>this.d.<strong>remove</strong>(key);</td>
</tr>
<tr>
<td></td>
<td>len(d)</td>
<td>size()</td>
<td>d.<strong>size</strong></td>
<td>d.size()</td>
</tr>
<tr>
<td></td>
<td></td>
<td>d.empty()  //true; false</td>
<td></td>
<td></td>
</tr>
<tr>
<td>NotOK</td>
<td></td>
<td></td>
<td>{k:v} in Initialization</td>
<td></td>
</tr>
<tr>
<td>Special APIs</td>
<td></td>
<td>reserve(capacity)</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Iterate</td>
<td>for k in d.keys():</td>
<td>for (auto k: d)</td>
<td>for (var key in dict){}</td>
<td>for(char c:  ransomNote.toCharArray()) {</td>
</tr>
<tr>
<td><strong>Ordered_dict</strong></td>
<td>self.od.popitem(last=False)<br /><a href="https://www.pythonf.cn/read/89970" target="_blank" rel="noopener">https://www.pythonf.cn/read/89970</a><br /><a href="https://gist.github.com/joequery/12332f410a05e6c7c949" target="_blank" rel="noopener">https://gist.github.com/joequery/12332f410a05e6c7c949</a></td>
<td></td>
<td>d = new Map(); APIs↑↑ //ref: <a href="https://stackoverflow.com/questions/2798893/ordered-hash-in-javascript" target="_blank" rel="noopener">https://stackoverflow.com/questions/2798893/ordered-hash-in-javascript</a></td>
<td>LinkedHashMap&lt;Integer, Integer&gt; d;<br />this.d = new LinkedHashMap&lt;&gt;();</td>
</tr>
<tr>
<td></td>
<td>first = next(iter(self.od))</td>
<td></td>
<td></td>
<td>Integer first = this.d.keySet().iterator().next();</td>
</tr>
<tr>
<td><strong>queue</strong></td>
<td>from collections import deque</td>
<td>include  <deque></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>deque();</td>
<td>deque&lt;Node*&gt;</td>
<td>let Q = [];</td>
<td>Queue<Node> Q = new LinkedList(); //LinkedList<Node> Q = new LinkedList<Node>(); //雙向</td>
</tr>
<tr>
<td></td>
<td>Q.append(cur); v=Q.popleft()</td>
<td>Q.push_back(cur); v=Q.front(),Q.pop_front()</td>
<td>Q.push(cur); v=Q.shift(); // O(n)</td>
<td>Q.add(nbr_O);//Q.push(nbr_O); Q.poll();</td>
</tr>
<tr>
<td></td>
<td>while d</td>
<td>while (!Q.empty())</td>
<td>while (Q.length != 0)</td>
<td>while (!Q.isEmpty())</td>
</tr>
<tr>
<td><strong>deque</strong></td>
<td></td>
<td></td>
<td></td>
<td>ArrayDeque雙向實現了DEque的interface</td>
</tr>
<tr>
<td><strong>vector</strong></td>
<td></td>
<td>include <vector></td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td>self.res = []</td>
<td>vector&lt;vector<int>&gt; result;</td>
<td>res = [];</td>
<td>List&lt;List<Integer>&gt; res = new ArrayList&lt;List<Integer>&gt;();</td>
</tr>
<tr>
<td></td>
<td>item.append(nums[idx])</td>
<td>item.push_back(nums[idx]);</td>
<td>item.push(nums[idx]);</td>
<td>item.add(nums[idx]);</td>
</tr>
<tr>
<td></td>
<td>item.pop()</td>
<td>item.pop_back();</td>
<td>item.pop();</td>
<td>item.remove(item.size()-1);</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td>l.length; // 注意！跟dict不同，這邊是 length</td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>for</td>
<td>for (<strong><em>let</em></strong> i=0; i&lt;l.length; i++)</td>
<td></td>
</tr>
<tr>
<td></td>
<td>l = [False] * 3</td>
<td>vector<bool> dp(3, false);</td>
<td>const dp = new Array(3).fill(false);</td>
<td>List<Boolean> dp = new ArrayList(Collections.nCopies(s.length(), false));</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td>int[] nums;, nums.length</td>
</tr>
<tr>
<td><strong>Doublely LinkedList</strong></td>
<td></td>
<td><strong>std::list</strong><br /><strong>List</strong> stores elements at non contiguous memory location i.e. it internally uses a doubly linked list i.e.</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>back(); front();</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>pop_back(); pop_front();</td>
<td></td>
<td></td>
</tr>
<tr>
<td></td>
<td></td>
<td>db_ll.erase(d[key])</td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>APIs</strong></td>
<td>from collections import Counter<br />Counter(l)</td>
<td>X</td>
<td>_.countBy(l)</td>
<td>X</td>
</tr>
<tr>
<td></td>
<td>max</td>
<td>max</td>
<td>Math.max</td>
<td>Math.max</td>
</tr>
<tr>
<td><strong>String</strong></td>
<td>len(s)</td>
<td>s.length()</td>
<td>s.length</td>
<td>s.length()</td>
</tr>
<tr>
<td></td>
<td>s[i]</td>
<td>s[i]</td>
<td>s[i]</td>
<td>s.charAt(i)</td>
</tr>
<tr>
<td></td>
<td>s[3:5]</td>
<td>token = s.substr(start, i-start+1);</td>
<td>s.slice(3, 5);</td>
<td>s.substring(start, i+1);</td>
</tr>
<tr>
<td><strong>Set</strong></td>
<td>ws = set(wD)</td>
<td>unordered_set<string> ws;<br/>        <br/>        for (auto s: wordDict){<br/>            ws.insert(s);<br/>        }</td>
<td>let ws = new Set(wD)</td>
<td>HashSet<String> ws = new HashSet(wordDict);</td>
</tr>
<tr>
<td></td>
<td>token in ws</td>
<td>ws.find(token) != ws.end()</td>
<td>ws.has(token)</td>
<td>ws.contains(token)</td>
</tr>
<tr>
<td><strong>MAX</strong></td>
<td>float(‘-inf’)</td>
<td>INT_MIN;</td>
<td>-Number.MAX_VALUE;</td>
<td>Integer.MIN_VALUE;</td>
</tr>
<tr>
<td><strong>2D Init</strong></td>
<td>[[0 for j in range(n)] for i in range(m)]</td>
<td></td>
<td></td>
<td>[…Array(3)].map(x=&gt;Array(5).fill(0))</td>
</tr>
<tr>
<td><strong>1D sort</strong></td>
<td>l.sort(reverse=True)</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td><strong>Node</strong></td>
<td>if not head</td>
<td>if (!head); if (nullputr == head)</td>
<td>if (!root); if (head == null)</td>
<td>if (head == null)</td>
</tr>
</tbody></table>
<h2 id="Special-issues"><a href="#Special-issues" class="headerlink" title="Special issues:"></a>Special issues:</h2><ul>
<li>Java &amp; js</li>
<li><img src="https://tva1.sinaimg.cn/large/007S8ZIlgy1gegmwb46qaj312a0u0qb1.jpg" alt="image-20200504191823941" style="zoom:67%;" /></li>
</ul>
</div><hr></div><nav id="pagination"><div class="pagination"><a class="extend prev" rel="prev" href="/page/48/"><i class="fa fa-chevron-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/48/">48</a><span class="page-number current">49</span><a class="page-number" href="/page/50/">50</a><span class="space">&hellip;</span><a class="page-number" href="/page/60/">60</a><a class="extend next" rel="next" href="/page/50/"><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2020 By Joe Huang</div><div class="framework-info"><span>Driven - </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a href="https://github.com/Molunerfinn/hexo-theme-melody" target="_blank" rel="noopener"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>